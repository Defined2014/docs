---
title: tiup cluster scale-in
---

# tiup cluster scale-in {#tiup-cluster-scale-in}

`tiup cluster scale-in`コマンドを使用してクラスターをスケールインします。これにより、指定されたノードのサービスがオフラインになり、指定されたノードがクラスターから削除され、それらのノードから残りのファイルが削除されます。

## コンポーネントのオフライン プロセスの特定の処理 {#particular-handling-of-components-offline-process}

TiKV、 TiFlash、および TiDB Binlogコンポーネントは非同期的にオフラインにされ (最初に API を介してノードを削除する必要があるため)、停止プロセスに時間がかかるため (ノードが正常にオフラインにされたかどうかをTiUPが継続的にチェックする必要があります) 、 TiKV、 TiFlash、および TiDB Binlogコンポーネントは、特に次のように処理されます。

-   TiKV、 TiFlash、および TiDB Binlogコンポーネントの場合:

    1.  TiUP クラスタ はAPI を介してノードをオフラインにし、プロセスの完了を待たずに直接終了します。
    2.  スケールイン中のノードのステータスを確認するには、 `tiup cluster display`コマンドを実行し、ステータスが`Tombstone`になるのを待つ必要があります。
    3.  `Tombstone`状態のノードをクリーンアップするには、 `tiup cluster prune`コマンドを実行する必要があります。 `tiup cluster prune`コマンドは、次の操作を実行します。

        -   オフラインになったノードのサービスを停止します。
        -   オフラインになったノードのデータ ファイルをクリーンアップします。
        -   クラスタ トポロジを更新し、オフラインになったノードを削除します。

その他のコンポーネントの場合:

-   PD コンポーネントをオフラインにすると、 TiUP クラスタ はAPI を介して指定されたノードをクラスターからすばやく削除し、指定された PD ノードのサービスを停止してから、関連するデータ ファイルをノードから削除します。
-   他のコンポーネントを停止すると、 TiUP クラスタ はノード サービスを直接停止し、指定されたノードから関連するデータ ファイルを削除します。

## 構文 {#syntax}

```shell
tiup cluster scale-in <cluster-name> [flags]
```

`<cluster-name>`は、スケールインするクラスターの名前です。クラスター名を忘れた場合は、 [`tiup cluster list`](/tiup/tiup-component-cluster-list.md)コマンドを使用して確認できます。

## オプション {#options}

### -N, --ノード {#n-node}

-   停止するノードを指定します。複数のノードはカンマで区切ります。
-   データ型: `STRING`
-   デフォルト値はありません。このオプションは必須であり、値は null であってはなりません。

### &#x20;--force {#force}

-   指定したノードをクラスターから強制的に削除するかどうかを制御します。場合によっては、オフラインにするノードのホストがダウンし、SSH 経由でノードに接続して操作できない場合があるため、オプション`--force`を使用してノードをクラスターから強制的に削除できます。
-   データ型: `BOOLEAN`
-   このオプションはデフォルトで無効になっており、値は`false`です。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`渡すか、値を何も渡さないでください。

> **警告：**
>
> このオプションを使用して、稼働中またはオフライン保留中の TiKV またはTiFlashノードを強制的に削除すると、これらのノードはデータの移行を待たずにすぐに削除されます。これにより、データ損失のリスクが非常に高くなります。メタデータが配置されているリージョンでデータ損失が発生した場合、クラスター全体が使用できなくなり、回復できなくなります。

### --transfer-timeout {#transfer-timeout}

-   PD または TiKV ノードが削除される場合、ノードのリージョンリーダーが最初に別のノードに転送されます。転送プロセスには時間がかかるため、 `--transfer-timeout`を構成して最大待機時間 (秒単位) を設定できます。タイムアウト後、 `tiup cluster scale-in`コマンドは待機をスキップし、スケールインを直接開始します。
-   データ型: `UINT`
-   このオプションはデフォルトで有効になっており、 `300`秒 (デフォルト値) が渡されます。

> **ノート：**
>
> リーダーの転送が完了するのを待たずに PD または TiKV ノードを直接オフラインにすると、サービスのパフォーマンスが低下する可能性があります。

### -h, --help {#h-help}

-   ヘルプ情報を出力します。
-   データ型: `BOOLEAN`
-   このオプションはデフォルトで無効になっており、値は`false`です。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`渡すか、値を何も渡さないでください。

## 出力 {#output}

スケールイン プロセスのログを表示します。

[&lt;&lt; 前のページに戻る - TiUP クラスタコマンド一覧](/tiup/tiup-component-cluster.md#command-list)
