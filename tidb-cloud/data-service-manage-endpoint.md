---
title: Manage an Endpoint
summary: Learn how to create, develop, test, deploy, and delete an endpoint in a Data App in the TiDB Cloud console.
---

# エンドポイントを管理する {#manage-an-endpoint}

Data Service (ベータ) のエンドポイントは、SQL ステートメントを実行するためにカスタマイズできる Web API です。 `WHERE`節で使用される値など、SQL ステートメントのパラメーターを指定できます。クライアントがエンドポイントを呼び出し、要求 URL のパラメーターに値を提供すると、エンドポイントは提供されたパラメーターを使用して SQL ステートメントを実行し、結果を HTTP 応答の一部として返します。

このドキュメントでは、 TiDB Cloudコンソールの Data App でエンドポイントを管理する方法について説明します。

## あなたが始める前に {#before-you-begin}

エンドポイントを管理する前に、クラスターとデータ アプリが作成されていることを確認してください。詳細については、 [TiDB クラスターを作成する](/tidb-cloud/create-tidb-cluster.md)および[データ アプリを作成する](/tidb-cloud/data-service-manage-data-app.md#create-a-data-app)を参照してください。

エンドポイントを呼び出す前に、データ アプリで API キーを作成したことを確認してください。詳細については、 [API キーを作成する](/tidb-cloud/data-service-api-key.md#create-an-api-key)を参照してください。

## エンドポイントを作成する {#create-an-endpoint}

エンドポイントを作成するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左側のペインで、ターゲット データ アプリの名前をクリックし、 **[...]** &gt; <strong>[エンドポイントの作成]</strong>をクリックします。必要に応じて、デフォルト名を更新できます。

    > **ヒント：**
    >
    > または、データ アプリを見つけて、左側のペインの上部にある**[+**<strong>エンドポイントの作成]</strong>をクリックすることもできます。

3.  新しく作成されたエンドポイントがエンドポイント リストの一番上に追加されます。

Chat2Query (ベータ版) で SQL ファイルからエンドポイントを作成することもできます。詳細については、 [SQL ファイルからエンドポイントを生成する](/tidb-cloud/explore-data-with-chat2query.md#generate-an-endpoint-from-a-sql-file)を参照してください。

## エンドポイントを開発する {#develop-an-endpoint}

エンドポイントごとに、TiDB クラスターで実行する SQL ステートメントを記述したり、SQL ステートメントのパラメーターを定義したり、名前とバージョンを管理したりできます。

### プロパティの構成 {#configure-properties}

エンドポイントの詳細ページの右側のペインで、 **[プロパティ]**タブをクリックして、エンドポイントの次のプロパティを表示および管理できます。

-   **エンドポイント パス**: ユーザーがアクセスするために使用するエンドポイントの一意のパス。

    -   パスはデータ アプリ内で一意である必要があります。
    -   パスには文字、数字、アンダースコア ( `_` )、およびスラッシュ ( `/` ) のみを使用でき、スラッシュ ( `/` ) で始まる必要があります。たとえば、 `/my_endpoint/get_id`です。
    -   パスの長さは 64 文字未満にする必要があります。

-   **エンドポイント URL** : (読み取り専用) URL は、データ アプリのサービス URL とエンドポイントのパスに基づいて自動的に生成されます。たとえば、エンドポイントのパスが`/my_endpoint/get_id`の場合、エンドポイント URL は`https://data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/my_endpoint/get_id`です。

-   **Request Method** : エンドポイントの HTTP メソッド。次の方法がサポートされています。

    -   `GET` : このメソッドを使用して、 `SELECT`ステートメントなどのデータをクエリします。
    -   `POST` : このメソッドを使用して、 `INSERT`ステートメントなどのデータを挿入します。

-   **Timeout(ms)** : エンドポイントのタイムアウト。

    -   デフォルト値: `5000`
    -   最大値: `30000`
    -   最小値: `1`
    -   単位：ミリ秒

-   **Max Rows** : エンドポイントが返す最大行数。

    -   デフォルト値: `50`
    -   最大値: `2000`
    -   最小値: `1`

-   **説明**(オプション): エンドポイントの説明。

### SQL ステートメントを作成する {#write-sql-statements}

エンドポイントの詳細ページの SQL エディターで、エンドポイントの SQL ステートメントを記述して実行できます。 `--`入力してから命令を入力するだけで、AI に SQL ステートメントを自動的に生成させることもできます。

1.  クラスターを選択します。

    > **ノート：**
    >
    > ドロップダウン リストには、データ アプリにリンクされているクラスターのみが表示されます。リンクされたクラスターを管理するには、 [リンクされたクラスターを管理する](/tidb-cloud/data-service-manage-data-app.md#manage-linked-clusters)を参照してください。

    SQL エディターの上部で、SQL ステートメントを実行するクラスターをドロップダウン リストから選択します。次に、右側のペインの**[スキーマ]**タブで、このクラスターのすべてのデータベースを表示できます。

2.  SQL ステートメントを記述します。

    データを照会または変更する前に、まず SQL ステートメントでデータベースを指定する必要があります。たとえば、 `USE database_name;`です。

    SQL エディターでは、テーブル結合クエリ、複雑なクエリ、集計関数のステートメントを記述できます。 `--`入力してから命令を入力するだけで、AI に SQL ステートメントを自動的に生成させることもできます。

    パラメーターを定義するには、SQL ステートメントに`${ID}`のような変数プレースホルダーとして挿入できます。たとえば、 `SELECT * FROM table_name WHERE id = ${ID}`です。次に、右側のペインの**[Params]**タブをクリックして、パラメーターの定義とテスト値を変更できます。詳細については、 [パラメーター](#configure-parameters)を参照してください。

    > **ノート：**
    >
    > -   パラメータ名は大文字と小文字が区別されます。
    > -   このパラメーターは、テーブル名または列名として使用できません。

3.  SQL ステートメントを実行します。

    SQL ステートメントにパラメーターを挿入した場合は、右側のペインの**[パラメーター]**タブでパラメーターのテスト値またはデフォルト値を設定したことを確認してください。それ以外の場合は、エラーが返されます。

    SQL ステートメントを実行するには、カーソルで SQL の行を選択し、 **[実行]** &gt; <strong>[カーソル位置で実行]</strong>をクリックします。

    SQL エディターですべての SQL ステートメントを実行するには、 **[実行]**をクリックします。この場合、最後の SQL 結果のみが返されます。

    ステートメントを実行すると、ページの下部にある**[結果]**タブにクエリの結果がすぐに表示されます。

### パラメータの構成 {#configure-parameters}

エンドポイントの詳細ページの右側のペインで、 **[Params]**タブをクリックして、エンドポイントで使用されるパラメーターを表示および管理できます。

**[定義]**セクションでは、パラメーターの次のプロパティを表示および管理できます。

-   パラメータ名: 名前には、文字、数字、およびアンダースコア ( `_` ) のみを含めることができ、文字またはアンダースコア ( `_` ) で開始する必要があります。
-   **Required** : リクエストでパラメータが必須かどうかを指定します。デフォルトの構成は不要に設定されています。
-   **Type** : パラメータのデータ型を指定します。サポートされている値は`STRING` 、 `NUMBER` 、および`BOOLEAN`です。 `STRING`タイプのパラメーターを使用する場合、引用符 ( `'`または`"` ) を追加する必要はありません。たとえば、 `foo` `STRING`タイプに有効であり、 `"foo"`として処理されますが、 `"foo"` `"\"foo\""`として処理されます。
-   **デフォルト値**: パラメータのデフォルト値を指定します。

    -   値をパラメータの型に変換できることを確認してください。それ以外の場合、エンドポイントはエラーを返します。
    -   パラメータのテスト値を設定しない場合、エンドポイントのテスト時にデフォルト値が使用されます。

**[テスト値]**セクションでは、テスト パラメータを表示および設定できます。これらの値は、エンドポイントをテストするときにパラメーター値として使用されます。値をパラメータの型に変換できることを確認してください。それ以外の場合、エンドポイントはエラーを返します。

### バージョンを管理する {#manage-versions}

エンドポイントの詳細ページの右側のペインで、 **[展開]**タブをクリックして、エンドポイントの展開されたバージョンを表示および管理できます。

**[展開]**タブでは、ドラフト バージョンを展開し、オンライン バージョンを展開解除できます。

### 名前を変更 {#rename}

エンドポイントの名前を変更するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。
2.  左ペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。
3.  名前を変更するエンドポイントを見つけて、 **[...]** &gt; <strong>[名前の変更</strong>] をクリックし、エンドポイントの新しい名前を入力します。

## エンドポイントをテストする {#test-an-endpoint}

エンドポイントをテストするには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左ペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。

3.  テストするエンドポイントの名前をクリックして、その詳細を表示します。

4.  (オプション) エンドポイントにパラメーターが含まれている場合は、テストの前にテスト値を設定する必要があります。

    1.  エンドポイントの詳細ページの右側のペインで、 **[Params]**タブをクリックします。
    2.  **[テスト値]**セクションを展開し、パラメーターのテスト値を設定します。

        パラメータのテスト値を設定しない場合は、デフォルト値が使用されます。

5.  右上隅の**[テスト]**をクリックします。

    > **ヒント：**
    >
    > または、 <kbd>F5 キー</kbd>を押してエンドポイントをテストすることもできます。

エンドポイントをテストすると、ページの下部に JSON として応答が表示されます。 JSON 応答の詳細については、 [エンドポイントの応答](#response)を参照してください。

## エンドポイントをデプロイ {#deploy-an-endpoint}

エンドポイントをデプロイするには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左ペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。

3.  展開するエンドポイントを見つけ、エンドポイント名をクリックして詳細を表示し、右上隅の**[デプロイ]**をクリックします。

4.  **[デプロイ]**をクリックして、展開を確認します。<strong>エンドポイントが正常にデプロイされる</strong>と、「エンドポイントがデプロイされました」というプロンプトが表示されます。

    エンドポイントの詳細ページの右側のペインで、 **[展開]**タブをクリックして、展開された履歴を表示できます。

## エンドポイントを呼び出す {#call-an-endpoint}

エンドポイントを呼び出すには、エンドポイントの展開されていないドラフト バージョンまたは展開されたオンライン バージョンのいずれかに HTTPS 要求を送信できます。

### 前提条件 {#prerequisites}

エンドポイントを呼び出す前に、API キーを作成する必要があります。詳細については、 [API キーを作成する](/tidb-cloud/data-service-api-key.md#create-an-api-key)を参照してください。

### リクエスト {#request}

TiDB Cloud は、エンドポイントを呼び出すのに役立つコード例を生成します。コード例を取得するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左ペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。

3.  呼び出すエンドポイントを見つけて、 **[...]** &gt; <strong>[Code Example]</strong>をクリックします。 <strong>[コード例]</strong>ダイアログ ボックスが表示されます。

    > **ヒント：**
    >
    > または、エンドポイント名をクリックして詳細を表示し、右上隅の**[...]** &gt; <strong>[コード例]</strong>をクリックすることもできます。

4.  ダイアログ ボックスで、エンドポイントの呼び出しに使用するクラスターとデータベースを選択し、コード例をコピーします。

    > **ノート：**
    >
    > -   コード例は、エンドポイントのプロパティとパラメーターに基づいて生成されます。
    > -   オンライン環境は、エンドポイントをデプロイした後にのみ使用できます。
    > -   現在、 TiDB Cloud はcurl コードの例のみを提供しています。

    curl コード例の例は次のとおりです。

    <SimpleTab>
     <div label="Test Environment">

    エンドポイントのドラフト バージョンを呼び出すには、 `endpoint-type: draft`ヘッダーを追加する必要があります。

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request GET 'https://data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>' \
      --header 'endpoint-type: draft'
    ```

    </div>

    <div label="Online Environment">

    オンライン環境でコード例を確認する前に、まずエンドポイントを展開する必要があります。

    エンドポイントの現在のオンライン バージョンを呼び出すには、次のコマンドを使用します。

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request GET 'https://data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>'
    ```

    </div>
     </SimpleTab>

5.  コード例をアプリケーションに貼り付けて実行します。

    -   `<Public Key>`と`<Private Key>`プレースホルダーを API キーに置き換える必要があります。詳細については、 [API キーを管理する](/tidb-cloud/data-service-api-key.md)を参照してください。
    -   エンドポイントにパラメーターが含まれている場合は、エンドポイントを呼び出すときにパラメーター値を指定します。

### 応答 {#response}

エンドポイントを呼び出した後、JSON 形式で応答を確認できます。詳細については、 [データ サービスの応答コードとステータス コード](/tidb-cloud/data-service-response-and-status-code.md)を参照してください。

## エンドポイントのアンデプロイ {#undeploy-an-endpoint}

エンドポイントをアンデプロイするには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。
2.  左ペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。
3.  アンデプロイするエンドポイントの名前をクリックして、その詳細を表示します。
4.  エンドポイントの詳細ページの右側のペインで、 **[展開]**タブをクリックします。デプロイされたバージョンのページが表示されます。
5.  現在のオンライン バージョンを見つけて、 **[Undeploy]**をクリックします。バージョン ステータスが<strong>Offline</strong>に変更されます。

## エンドポイントを削除する {#delete-an-endpoint}

> **ノート：**
>
> エンドポイントを削除する前に、エンドポイントがオンラインでないことを確認してください。そうしないと、エンドポイントを削除できません。エンドポイントをアンデプロイするには、 [エンドポイントのアンデプロイ](#undeploy-an-endpoint)を参照してください。

エンドポイントを削除するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左ペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。

3.  削除するエンドポイントを見つけて、 **[...]** &gt; <strong>[削除]</strong>をクリックします。 <strong>[エンドポイントの削除を確認]</strong>ダイアログ ボックスが表示されます。

    > **ヒント：**
    >
    > または、エンドポイント名をクリックして詳細を表示し、右上隅の**[...]** &gt; <strong>[削除]</strong>をクリックすることもできます。

4.  **[削除]**をクリックして、削除を確認します。
