---
title: Back Up and Restore TiDB Cluster Data
summary: Learn how to back up and restore your TiDB Cloud cluster.
aliases: ['/tidbcloud/restore-deleted-tidb-cluster']
---

# TiDBクラスタデータのバックアップと復元 {#back-up-and-restore-tidb-cluster-data}

このドキュメントでは、 TiDB Cloudで TiDB クラスター データをバックアップおよび復元する方法について説明します。

## 制限事項 {#limitations}

### Dedicated Tier {#dedicated-tier}

-   TiDB Cloud は、ユーザー権限やシステム変数を含め、 `mysql`スキーマ内のテーブルの復元をサポートしていません。 [Dumplingと稲妻](https://docs.pingcap.com/tidb/stable/backup-and-restore-using-dumpling-lightning)使用して、これらのデータを手動でバックアップおよび復元できます。
-   PITR (ポイントインタイム リカバリ) を複数回オン/オフする場合、最新の PITR が有効になった後の回復可能な範囲内の時点のみを選択できます。以前の回復可能な範囲にはアクセスできません。

### Serverless Tier {#serverless-tier}

-   Serverless Tierクラスターは、バックアップからのインプレース復元のみをサポートすることに注意してください。復元が実行されると、 `mysql`スキーマ内のテーブルも影響を受けます。したがって、ユーザーの資格情報とアクセス許可、またはシステム変数に加えられた変更は、バックアップが作成されたときの状態にロールバックされます。
-   手動バックアップはまだサポートされていません。
-   PITR (ポイントインタイム リカバリ) はまだサポートされていません。
-   復元プロセス中はクラスターを使用できなくなり、既存の接続は終了します。復元が完了すると、新しい接続を確立できます。
-   TiFlashレプリカが有効になっている場合、 TiFlashでデータを再構築する必要があるため、復元後しばらくの間、レプリカは使用できなくなります。

## バックアップ {#backup}

[Serverless Tier](#serverless-tier)と[Dedicated Tier](#dedicated-tier)の両方のデータをバックアップできます。

### Serverless Tier {#serverless-tier}

自動バックアップは、バックアップ設定に従ってServerless Tierクラスターに対してスケジュールされます。これにより、極端な災害状況での損失を減らすことができます。

#### 自動バックアップ {#automatic-backup}

自動バックアップにより、設定したバックアップ時刻に毎日Serverless Tierクラスタのデータをバックアップできます。バックアップ時間を設定するには、次の手順を実行します。

1.  Serverless Tierクラスターの**[バックアップ]**ページに移動します。

2.  **[バックアップ設定]**をクリックします。これにより、 <strong>[バックアップ設定]</strong>ウィンドウが開き、要件に応じて自動バックアップ設定を構成できます。

    -   **[バックアップ時間]**で、毎日のクラスター バックアップの開始時間をスケジュールします。

        優先バックアップ時刻を指定しない場合、 TiDB Cloud はデフォルトのバックアップ時刻を割り当てます。これは、クラスターが配置されている地域のタイム ゾーンの午前 2 時です。

    -   **[バックアップの保持]**で、バックアップ データの最小保持期間を構成します。

        バックアップの保持期間は、7 ～ 90 日の範囲内で設定する必要があります。

3.  **[確認]**をクリックします。

#### バックアップファイルを削除する {#delete-backup-files}

既存のバックアップ ファイルを削除するには、次の手順を実行します。

1.  クラスターの**[バックアップ]**タブに移動します。

2.  削除するバックアップ ファイルの**[削除]**をクリックします。

### Dedicated Tier {#dedicated-tier}

TiDB Cloud Dedicated Tier は、自動バックアップと手動バックアップをサポートしています。

自動バックアップは、バックアップ設定に従ってDedicated Tierクラスターに対してスケジュールされます。これにより、極端な災害状況での損失を減らすことができます。バックアップ スナップショットを選択して、いつでも新しい TiDB クラスターに復元することもできます。

#### 自動バックアップ {#automatic-backup}

自動バックアップにより、毎日設定したバックアップ時刻にDedicated Tierクラスターのデータをバックアップできます。バックアップ時間を設定するには、次の手順を実行します。

1.  Dedicated Tierクラスターの**[バックアップ]**ページに移動します。

2.  **[バックアップ設定]**をクリックします。設定ウィンドウが表示されます。

3.  設定ウィンドウで、自動バックアップを構成します。

    -   **[自動バックアップ]**スイッチを<strong>[オン]</strong>に切り替えます。

    -   **[バックアップ時間]**で、毎日のクラスター バックアップの開始時間をスケジュールします。

        ワークロードの低い期間に自動バックアップをスケジュールすることをお勧めします。優先バックアップ時刻を指定しない場合、 TiDB Cloud はデフォルトのバックアップ時刻を割り当てます。これは、クラスターが配置されている地域のタイム ゾーンの午前 2 時です。

    -   **[バックアップの保持]**で、バックアップ データの最小保持期間を構成します。

    -   PITR (**ポイントインタイム リカバリ**) 機能をオンまたはオフにします。

        PITR は、任意の時点のデータを新しいクラスターに復元することをサポートしています。次の目的で使用できます。

        -   ディザスタ リカバリの RPO を削減します。
        -   エラー イベントの前のポイント イン タイムを復元することで、データ書き込みエラーのケースを解決します。
        -   ビジネスの履歴データを監査します。

        上記のいずれかのニーズがあり、PITR 機能を使用したい場合は、TiDB クラスターのバージョンが少なくとも v6.4.0 であり、TiKV ノードのサイズが少なくとも 8 vCPU および 16 GiB であることを確認してください。

    -   **[バックアップ ストレージリージョン]**で、バックアップ データを保存するリージョンを選択します。

        TiDB Cloud は、デフォルトで、クラスターの現在のリージョンにバックアップ データを保存します。この動作は変更できません。さらに、別のリモート リージョンを追加できます。TiDB TiDB Cloud はすべての新しいバックアップ データをリモート リージョンにコピーします。これにより、データの安全性と迅速な復旧が促進されます。リモート リージョンをバックアップ データstorageとして追加した後は、リージョンを削除できません。

4.  **[確認]**をクリックして、構成の変更をプレビューします。

    PITR をオンにすると、 **[すぐにバックアップを実行し、PITR のリカバリの開始点として使用する] を選択できます。**チェックボックス。そうしないと、次のバックアップが完了するまで PITR を使用できません。

5.  **[確認]**をクリックします。

#### バックアップstorageリージョンのサポート {#backup-storage-region-support}

現在、バックアップ データstorage用に任意のリモート リージョンを選択することはできません。すでにサポートされているリージョンは次のとおりです。

| クラウド プロバイダー | クラスタ地域               | リモート地域のサポート          |
| ----------- | -------------------- | -------------------- |
| GCP         | 東京 (asia-northeast1) | 大阪 (asia-northeast2) |

> **ノート：**
>
> 複数のバックアップstorageリージョンを選択した場合、複数のバックアップstorageと、クラスター リージョンから各宛先リージョンへのリージョン間バックアップ データ レプリケーションに対して課金されます。コストはリージョン単位であり、選択したバックアップ リージョンによって異なります。詳細については、 [データ バックアップのコスト](https://www.pingcap.com/tidb-cloud-pricing-details/#backup-storage-cost)を参照してください。

#### 手動バックアップ {#manual-backup}

手動バックアップは、必要に応じてデータを既知の状態にバックアップし、いつでもその状態に復元できるようにする、ユーザーが開始するバックアップです。

TiDB クラスターに手動バックアップを適用するには、次の手順を実行します。

1.  クラスターの**[バックアップ]**タブに移動します。

2.  **[手動バックアップ]**をクリックします。設定ウィンドウが表示されます。

3.  **名前**を入力します。

4.  **[確認]**をクリックします。次に、クラスター データがバックアップされます。

#### バックアップファイルを削除する {#delete-backup-files}

既存のバックアップ ファイルを削除するには、次の手順を実行します。

1.  クラスターの**[バックアップ]**タブに移動します。

2.  削除するバックアップ ファイルの**[削除]**をクリックします。

#### 実行中のバックアップ ジョブを削除する {#delete-a-running-backup-job}

実行中のバックアップ ジョブを削除するには、 [**バックアップファイルを削除する**](#delete-backup-files)と同様です。

1.  クラスターの**[バックアップ]**タブに移動します。

2.  **保留中**または<strong>実行中</strong>の状態にあるバックアップ ファイルの<strong>[削除]</strong>をクリックします。

#### バックアップのベスト プラクティス {#best-practices-for-backup}

-   ビジネスへの影響を最小限に抑えるために、クラスターのアイドル時間にバックアップ操作を実行することをお勧めします。
-   データのインポート中、またはクラスターのスケーリング中に手動バックアップを実行しないでください。
-   クラスターを削除した後、既存の手動バックアップ ファイルは、手動で削除するか、アカウントが閉鎖されるまで保持されます。自動バックアップ ファイルは、クラスターの削除日から 31 日間保持されます。それに応じて、バックアップ ファイルを削除する必要があります。

## 戻す {#restore}

### Serverless Tier {#serverless-tier}

TiDB Cloud Serverless Tier はインプレース復元のみをサポートします。 Serverless Tierクラスターをバックアップから復元するには、次の手順に従います。

1.  クラスターの**[バックアップ]**ページに移動します。

2.  **[復元]**をクリックします。これにより、<strong>復元</strong>ウィンドウが開きます。

    1.  **[バックアップ時間]**ドロップダウン リストからバックアップを選択します。
    2.  **[確認]**をクリックして復元プロセスを開始します。

    復元プロセスを開始すると、クラスターのステータスが**[復元中]**に変わります。復元プロセス中はクラスターを使用できなくなり、既存の接続は終了します。復元プロセスが正常に完了すると、通常どおりクラスターにアクセスできます。

### Dedicated Tier {#dedicated-tier}

TiDB Cloud Dedicated Tier は、 2 種類のデータ復元を提供します。

-   バックアップ データを新しいクラスタに復元する
-   ごみ箱から削除されたクラスターを復元する

#### データを新しいクラスターに復元する {#restore-data-to-a-new-cluster}

TiDB クラスター データをバックアップから新しいクラスターに復元するには、次の手順を実行します。

1.  クラスターの**[バックアップ]**タブに移動します。

2.  **[復元]**をクリックします。設定ウィンドウが表示されます。

3.  **復元モード**では、任意の時点のデータまたは選択したバックアップを新しいクラスターに復元することを選択できます。

    <SimpleTab>
     <div label="Select Time Point">

    バックアップ保持期間内の任意の時点のデータを新しいクラスターに復元するには、 **[バックアップ設定]**で<strong>PITR が</strong>オンになっていることを確認してから、次の手順を実行します。

    1.  **[時点の選択]**をクリックします。
    2.  復元したい**日付**と<strong>時刻</strong>を選択します。

    </div>

    <div label="Select Backup Name">

    選択したバックアップを新しいクラスターに復元するには、次の手順を実行します。

    1.  **[バックアップ名の選択]**をクリックします。
    2.  復元するバックアップを選択します。

    </div>
     </SimpleTab>

4.  **[リージョンに復元]**で、 <strong>[バックアップ設定]</strong>で構成された<strong>バックアップ ストレージリージョン</strong>と同じリージョンを選択します。

5.  **[復元]**ウィンドウでは、必要に応じて次の変更を行うこともできます。

    -   クラスター名を設定します。
    -   クラスターのポート番号を更新します。
    -   クラスタのノード サイズ、ノード数、およびノードstorageを増やします。

6.  **[復元]**をクリックします。

    クラスターの復元プロセスが開始され、 **[Securityの設定]**ダイアログ ボックスが表示されます。

7.  **[Security設定]**ダイアログ ボックスで、ルート パスワードと許可された IP アドレスを設定してクラスターに接続し、 <strong>[適用]</strong>をクリックします。

#### 削除されたクラスターを復元する {#restore-a-deleted-cluster}

ごみ箱から削除されたクラスターを復元するには、次の手順を実行します。

1.  [TiDB Cloudコンソール](https://tidbcloud.com)にログインします。

2.  [**クラスター**](https://tidbcloud.com/console/clusters)ページの左側のナビゲーション ペインで、次のいずれかを実行します。

    -   複数のプロジェクトがある場合は、ターゲット プロジェクトに切り替えてから、 **[管理]** &gt; <strong>[ごみ箱]</strong>をクリックします。
    -   プロジェクトが 1 つしかない場合は、 **[管理]** &gt; <strong>[ごみ箱]</strong>をクリックします。

3.  復元するクラスターを見つけて、 **[アクション]**列の<strong>[バックアップ]</strong>をクリックします。

4.  目的のバックアップ時刻を見つけて、 **[アクション]**列の<strong>[復元]</strong>をクリックします。

5.  **[復元]**ウィンドウで、必要に応じて次の変更を行います。

    -   クラスターのポート番号を更新します。
    -   クラスタのノード サイズ、ノード数、およびノードstorageを増やします。

6.  **[確認]**をクリックします。

    クラスターの復元プロセスが開始され、 **[Securityの設定]**ダイアログ ボックスが表示されます。

7.  **[Security設定]**ダイアログ ボックスで、ルート パスワードと許可された IP アドレスを設定してクラスターに接続し、 <strong>[適用]</strong>をクリックします。

> **ノート：**
>
> 削除されたクラスターを任意の時点に復元することはできません。自動バックアップまたは手動バックアップのみを選択して復元できます。
