---
title: TiDB Cloud Built-in Monitoring
summary: Learn how to view TiDB Cloud built-in monitoring metrics and understand the meanings of these metrics.
---

# TiDB Cloud組み込みモニタリング {#tidb-cloud-built-in-monitoring}

TiDB Cloudは、クラスターの標準メトリックの完全なセットを収集して、[監視] ページに表示します。これらのメトリックを表示することで、パフォーマンスの問題を簡単に特定し、現在のデータベースの展開が要件を満たしているかどうかを判断できます。

> **ノート：**
>
> 現在、監視ページは[Serverless Tierクラスター](/tidb-cloud/select-cluster-tier.md#serverless-tier-beta)で利用できません。

## 監視ページをビューする {#view-the-monitoring-page}

[監視] ページでメトリックを表示するには、次の手順を実行します。

1.  [TiDB Cloudコンソール](https://tidbcloud.com/)で、プロジェクトの[**クラスター**](https://tidbcloud.com/console/clusters)ページに移動します。

    > **ヒント：**
    >
    > 複数のプロジェクトがある場合は、[**クラスター]**ページの左側のナビゲーション ペインでターゲット プロジェクトに切り替えることができます。

2.  ターゲット クラスタの名前をクリックします。クラスタの概要ページが表示されます。

3.  左側のナビゲーション ペインで [**監視]**をクリックします。

## メトリクス保持ポリシー {#metrics-retention-policy}

すべての監視データは 2 日間保持されます。

## 指標のモニタリング {#monitoring-metrics}

次のセクションでは、[監視] ページのメトリックについて説明します。

### データベース時間 {#database-time}

| 指標名                 | ラベル                          | 説明                                                                                                                                                                                                                                                                                         |
| :------------------ | :--------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SQL タイプ別のデータベース時間   | データベース時間、{SQL タイプ}           | データベース時間: 1 秒あたりの合計データベース時間。<br/> {SQL タイプ}: `SELECT` 、 `INSERT` 、および`UPDATE`などの SQL タイプ別に収集された、1 秒あたりの SQL ステートメントによって消費されたデータベース時間。                                                                                                                                                      |
| SQL フェーズごとのデータベース時間 | データベース時間、トークンの取得、解析、コンパイル、実行 | トークンの取得、解析、コンパイル、実行の 4 つの SQL 処理フェーズで消費されるデータベース時間。一般的に、SQL 実行フェーズは緑で、その他のフェーズは赤で表示されます。緑以外の領域が大きな割合を占める場合は、ほとんどのデータベース時間が実行フェーズ以外のフェーズで消費されていることを意味し、さらなる原因分析が必要です。                                                                                                                       |
| SQL 実行時間の概要         | tso_wait、Get、Cop、およびコミット     | 緑色のメトリックは一般的な KV 書き込み要求 (事前書き込みやコミットなど) を表し、青色のメトリックは一般的な読み取り要求を表し、他の色のメトリックは注意を払う必要がある予期しない状況を表します。たとえば、悲観的ロック KV 要求は赤でマークされ、TSO 待機は濃い茶色でマークされます。青色以外または緑色以外の領域が占める割合が大きい場合は、SQL 実行中にボトルネックが発生していることを意味します。たとえば、重大なロック競合が発生した場合、赤い領域が大きな割合を占めます。 TSO の待機に過度の時間が費やされると、こげ茶色の領域が大きな割合を占めます。 |

### アプリケーション接続 {#application-connection}

| 指標名 | ラベル         | 説明                                                                     |
| :-- | :---------- | :--------------------------------------------------------------------- |
| 接続数 | 合計、アクティブな接続 | 合計: すべての TiDB インスタンスへの接続数。<br/>アクティブな接続: すべての TiDB インスタンスへのアクティブな接続の数。 |
| 断線  | インスタンス      | 各 TiDB インスタンスに切断されたクライアントの数。                                           |

### SQL カウント {#sql-count}

| 指標名                     | ラベル                             | 説明                                                                                                             |
| :---------------------- | :------------------------------ | :------------------------------------------------------------------------------------------------------------- |
| 1 秒あたりのクエリ              | {SQL タイプ}                       | `SELECT` 、 `INSERT` 、 `UPDATE`などの SQL タイプ別に収集された、すべての TiDB インスタンスで 1 秒あたりに実行された SQL ステートメントの数。                 |
| 失敗したクエリ                 | エラーの種類                          | 各 TiDB インスタンスの 1 分あたりの SQL ステートメント実行エラーに基づく、エラーの種類 (構文エラーや主キーの競合など) の統計。エラーが発生したモジュールとエラーコードが含まれています。          |
| コマンド/秒                  | クエリ、StmtExecute、および StmtPrepare | コマンド タイプに基づいて、すべての TiDB インスタンスによって 1 秒あたりに処理されるコマンドの数。                                                         |
| Plan Cache OPS を使用したクエリ | ヒット、ミス                          | hit: すべての TiDB インスタンスでの 1 秒あたりのプラン キャッシュを使用したクエリの数。<br/> miss: すべての TiDB インスタンスで 1 秒あたりにプラン キャッシュが欠落しているクエリの数。 |

### レイテンシの内訳 {#latency-break-down}

| 指標名        | ラベル                       | 説明                                                                                                                                                                                                                                                                                                                                                                       |
| :--------- | :------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| クエリ期間      | avg-{SQL 型}、99-{SQL 型}    | クライアントから TiDB へのリクエストを受信してから、TiDB がリクエストを実行してクライアントに結果を返すまでの時間。通常、クライアント要求は SQL ステートメントの形式で送信されます。ただし、この期間には、 `COM_PING` 、 `COM_SLEEP` 、 `COM_STMT_FETCH` 、および`COM_SEND_LONG_DATA`などのコマンドの実行時間が含まれる場合があります。 TiDB は Multi-Query をサポートしています。これは、クライアントが`select 1; select 1; select 1;`などの複数の SQL ステートメントを一度に送信できることを意味します。この場合、このクエリの合計実行時間には、すべての SQL ステートメントの実行時間が含まれます。 |
| 平均アイドル接続時間 | avg-in-txn、avg-not-in-txn | 接続アイドル期間は、接続がアイドル状態である期間を示します。<br/> avg-in-txn: 接続がトランザクション内にある場合の平均接続アイドル時間。<br/> avg-not-in-txn: 接続がトランザクション内にない場合の平均接続アイドル時間。                                                                                                                                                                                                                                         |
| トークン期間を取得  | 平均、99                     | SQL ステートメントのトークンの取得に費やされた平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                                 |
| 解析期間       | 平均、99                     | SQL ステートメントの解析に費やされた平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                                      |
| コンパイル時間    | 平均、99                     | 解析された SQL AST を実行計画にコンパイルするのにかかった平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                         |
| 実行時間       | 平均、99                     | SQL ステートメントの実行計画の実行に費やされた平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                                 |

### トランザクション {#transaction}

| 指標名              | ラベル                                  | 説明                      |
| :--------------- | :----------------------------------- | :---------------------- |
| 1 秒あたりのトランザクション数 | {タイプ}-{トランザクション モデル}                 | 1 秒あたりに実行されたトランザクションの数。 |
| トランザクション期間       | avg-{トランザクション モデル}、99-{トランザクション モデル} | トランザクションの実行期間。          |

### コア パス期間 {#core-path-duration}

| 指標名                       | ラベル                                                  | 説明                                                                                                                                |
| :------------------------ | :--------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------- |
| 平均 TiDB KV リクエスト期間        | Get、Prewirite、Commit、および PessimisticLock             | `Get` 、 `Prewrite` 、および`Commit`を含むリクエスト タイプに基づく、すべての TiDB インスタンスでの KV リクエストの実行に費やされた平均時間。                                         |
| 平均 TiKV GRPC 期間           | kv_get、kv_prewirite、kv_commit、および kv_pessimisticLock | `kv_get` 、 `kv_prewrite` 、および`kv_commit`を含むすべての TiKV インスタンス ベースのリクエスト タイプで gRPC リクエストの実行にかかった平均時間。                                |
| 平均 / P99 PD TSO 待機/RPC 時間 | 待機-平均/99、rpc-平均/99                                   | 待機: PD がすべての TiDB インスタンスで TSO を返すのを待機する平均時間または P99 期間。<br/> RPC: TSO 要求を PD に送信してから、すべての TiDB インスタンスで TSO を受信するまでの平均時間または P99 期間。 |
| 平均 / P99 ストレージ非同期書き込み期間   | 平均、99                                                | 非同期書き込みで消費された平均時間または P99 期間。平均ストレージ非同期書き込み時間 = 平均ストア時間 + 平均適用時間。                                                                  |
| 平均 / P99 ストア期間            | 平均、99                                                | 非同期書き込み中のループの保存に費やされた平均時間または P99 期間。                                                                                              |
| 平均 / P99 適用時間             | 平均、99                                                | 非同期書き込み中のループの適用で消費された平均時間または P99 期間。                                                                                              |
| 平均 / P99 ログ追加期間           | 平均、99                                                | Raftがログを追加するために費やした平均時間または P99 期間。                                                                                                |
| 平均 / P99 コミット ログ期間        | 平均、99                                                | ログをコミットするためにRaftが消費した平均時間または P99 期間。                                                                                              |
| 平均 / P99 適用ログ期間           | 平均、99                                                | Raftがログを適用するために費やした平均時間または P99 期間。                                                                                                |

### サーバ {#server}

| 指標名              | ラベル                   | 説明                                |
| :--------------- | :-------------------- | :-------------------------------- |
| TiDB アップタイム      | インスタンス                | 前回の再起動以降の各 TiDB インスタンスの実行時間。      |
| TiDB の CPU 使用率   | インスタンス                | 各 TiDB インスタンスの CPU 使用率の統計。        |
| TiDB メモリ使用量      | インスタンス                | 各 TiDB インスタンスのメモリ使用統計。            |
| TiKV アップタイム      | インスタンス                | 前回の再起動以降の各 TiKV インスタンスの実行時間。      |
| TiKV の CPU 使用率   | インスタンス                | 各 TiKV インスタンスの CPU 使用率の統計。        |
| TiKV メモリ使用量      | インスタンス                | 各 TiKV インスタンスのメモリ使用量の統計。          |
| TiKV IO MBps     | インスタンス書き込み、インスタンス読み取り | 各 TiKV インスタンスでの読み取りと書き込みの合計バイト数。  |
| TiKV ストレージの使用量   | インスタンス                | TiKV インスタンスあたりのストレージ サイズ。         |
| TiFlash稼働時間      | インスタンス                | 前回の再起動以降の各TiFlashインスタンスの実行時間。     |
| TiFlash のCPU 使用率 | インスタンス                | 各TiFlashインスタンスの CPU 使用率の統計。       |
| TiFlashメモリ       | インスタンス                | 各TiFlashインスタンスのメモリ使用量の統計。         |
| TiFlash IO MBps  | インスタンス書き込み、インスタンス読み取り | 各TiFlashインスタンスでの読み取りと書き込みの合計バイト数。 |
| TiFlashストレージの使用量 | インスタンス                | TiFlashインスタンスあたりのストレージ サイズ。       |

## FAQ {#faq}

**1. このページの一部のペインが空白なのはなぜですか?**

ペインにメトリックが表示されない場合、考えられる理由は次のとおりです。

-   対応するクラスターのワークロードは、このメトリックをトリガーしません。たとえば、失敗したクエリがない場合、失敗したクエリ メトリックは常に空です。
-   クラスターのバージョンが低くなっています。これらのメトリックを表示するには、TiDB の最新バージョンにアップグレードする必要があります。

これらの理由がすべて除外されている場合は、トラブルシューティングのために[PingCAP サポート チーム](/tidb-cloud/tidb-cloud-support.md)に連絡できます。
