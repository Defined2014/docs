---
title: TiDB Cloud Built-in Monitoring
summary: Learn how to view TiDB Cloud built-in monitoring metrics and understand the meanings of these metrics.
---

# TiDB Cloud組み込みモニタリング {#tidb-cloud-built-in-monitoring}

TiDB Cloudは、クラスターの標準メトリクスの完全なセットを収集し、[モニタリング] ページに表示します。これらのメトリクスを表示することで、パフォーマンスの問題を簡単に特定し、現在のデータベース展開が要件を満たしているかどうかを判断できます。

> **ノート：**
>
> 現在、[監視] ページは[Serverless Tierクラスター](/tidb-cloud/select-cluster-tier.md#serverless-tier-beta)では利用できません。

## モニタリングページをビュー {#view-the-monitoring-page}

[モニタリング] ページでメトリクスを表示するには、次の手順を実行します。

1.  [**クラスター**](https://tidbcloud.com/console/clusters)ページに移動します。

    > **ヒント：**
    >
    > 複数のプロジェクトがある場合は、 **「クラスター」**ページの左側のナビゲーション・ペインでターゲット・プロジェクトに切り替えることができます。

2.  ターゲットクラスターの名前をクリックします。クラスターの概要ページが表示されます。

3.  左側のナビゲーション ペインで**[監視]**をクリックします。

## メトリクス保持ポリシー {#metrics-retention-policy}

すべての監視データは 2 日間保存されます。

## モニタリング指標 {#monitoring-metrics}

次のセクションでは、[監視] ページのメトリクスを説明します。

### データベース時間 {#database-time}

| メトリクス名             | ラベル                          | 説明                                                                                                                                                                                                                                                                                 |
| :----------------- | :--------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SQL タイプごとのデータベース時間 | データベース時間、{SQL タイプ}           | データベース時間: 1 秒あたりの合計データベース時間。<br/> {SQL タイプ}: SQL ステートメントによって消費された 1 秒あたりのデータベース時間。これは、 `SELECT` 、 `INSERT` 、 `UPDATE`などの SQL タイプごとに収集されます。                                                                                                                                         |
| SQLフェーズごとのデータベース時間 | データベース時間、トークンの取得、解析、コンパイル、実行 | トークンの取得、解析、コンパイル、実行という 4 つの SQL 処理フェーズで消費されるデータベース時間。通常、SQL 実行フェーズは緑色で、その他のフェーズは赤色で表示されます。緑色以外の領域が大きな割合を占める場合、データベース時間のほとんどが実行フェーズ以外のフェーズで消費されており、さらなる原因分析が必要であることを意味します。                                                                                                          |
| SQL実行時間の概要         | tso_wait、取得、監視、およびコミット       | 緑色のメトリクスは一般的な KV 書き込みリクエスト (事前書き込みやコミットなど) を表し、青のメトリクスは一般的な読み取りリクエストを表し、他の色のメトリクスは注意が必要な予期せぬ状況を表します。たとえば、悲観的ロック KV 要求は赤でマークされ、TSO 待機は濃い茶色でマークされます。青以外または緑以外の領域が大きな割合を占める場合は、SQL 実行中にボトルネックがあることを意味します。たとえば、深刻なロック競合が発生した場合、赤い領域が大きな割合を占めます。 TSO の待機に時間がかかりすぎると、濃い茶色の領域の割合が大きくなります。 |

### アプリケーション接続 {#application-connection}

| メトリクス名 | ラベル         | 説明                                                                      |
| :----- | :---------- | :---------------------------------------------------------------------- |
| 接続数    | アクティブな接続の合計 | 合計: すべての TiDB インスタンスへの接続の数。<br/>アクティブな接続: すべての TiDB インスタンスへのアクティブな接続の数。 |
| 断線     | インスタンス      | 各 TiDB インスタンスに切断されたクライアントの数。                                            |

### SQL数 {#sql-count}

| メトリクス名                 | ラベル                             | 説明                                                                                                               |
| :--------------------- | :------------------------------ | :--------------------------------------------------------------------------------------------------------------- |
| 1 秒あたりのクエリ数            | {SQL タイプ}                       | すべての TiDB インスタンスで 1 秒あたりに実行された SQL ステートメントの数。SQL タイプ ( `SELECT` 、 `INSERT` 、 `UPDATE`など) ごとに収集されます。              |
| 失敗したクエリ                | エラーの種類                          | 各 TiDB インスタンスでの 1 分あたりの SQL ステートメント実行エラーに基づく、エラー タイプ (構文エラーや主キーの競合など) の統計。エラーが発生したモジュールとエラーコードが含まれます。            |
| 1秒あたりのコマンド             | クエリ、StmtExecute、および StmtPrepare | コマンド タイプに基づく、すべての TiDB インスタンスによって 1 秒あたりに処理されるコマンドの数。                                                            |
| プラン キャッシュ OPS を使用したクエリ | ヒット、ミス                          | hit: すべての TiDB インスタンスにおける 1 秒あたりのプラン キャッシュを使用するクエリの数。<br/> miss: すべての TiDB インスタンスでプラン キャッシュが欠落しているクエリの 1 秒あたりの数。 |

### 遅延の内訳 {#latency-break-down}

| メトリクス名         | ラベル                        | 説明                                                                                                                                                                                                                                                                                                                                                                 |
| :------------- | :------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| クエリ期間          | avg-{SQL タイプ}、99-{SQL タイプ} | クライアントから TiDB へのリクエストを受信してから、TiDB がリクエストを実行して結果をクライアントに返すまでの期間。一般に、クライアント要求は SQL ステートメントの形式で送信されます。ただし、この期間には`COM_PING` 、 `COM_SLEEP` 、 `COM_STMT_FETCH` 、 `COM_SEND_LONG_DATA`などのコマンドの実行時間が含まれる場合があります。 TiDB はマルチクエリをサポートしています。これは、クライアントが一度に複数の SQL ステートメント ( `select 1; select 1; select 1;`など) を送信できることを意味します。この場合、このクエリの合計実行時間には、すべての SQL ステートメントの実行時間が含まれます。 |
| 平均アイドル接続時間     | TXN 内の平均、TXN 内にない平均        | 接続アイドル期間は、接続がアイドル状態である期間を示します。<br/> avg-in-txn: 接続がトランザクション内にある場合の平均接続アイドル期間。<br/> avg-not-in-txn: 接続がトランザクション内にない場合の平均接続アイドル時間。                                                                                                                                                                                                                                   |
| トークンの有効期間を取得する | 平均、99                      | SQL ステートメントのトークンを取得するために費やされた平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                       |
| 解析期間           | 平均、99                      | SQL ステートメントの解析に費やされる平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                                |
| コンパイル時間        | 平均、99                      | 解析された SQL AST を実行プランにコンパイルするのに費やされる平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                 |
| 実行期間           | 平均、99                      | SQL ステートメントの実行プランの実行に費やされる平均時間または P99 期間。                                                                                                                                                                                                                                                                                                                          |

### トランザクション {#transaction}

| メトリクス名         | ラベル                                  | 説明                      |
| :------------- | :----------------------------------- | :---------------------- |
| 1秒あたりのトランザクション | {タイプ}-{トランザクション モデル}                 | 1 秒あたりに実行されるトランザクションの数。 |
| トランザクション期間     | avg-{トランザクション モデル}、99-{トランザクション モデル} | トランザクションの実行期間。          |

### コアパスの継続時間 {#core-path-duration}

| メトリクス名                    | ラベル                                                  | 説明                                                                                                                                   |
| :------------------------ | :--------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------- |
| 平均 TiDB KV リクエスト期間        | 取得、事前書き込み、コミット、PessimisticLock                       | `Get` 、 `Prewrite` 、 `Commit`などのリクエスト タイプに基づく、すべての TiDB インスタンスでの KV リクエストの実行にかかる平均時間。                                                |
| 平均 TiKV GRPC 継続時間         | kv_get、kv_prewirite、kv_commit、および kv_pessimisticLock | すべての TiKV インスタンス ベースのリクエスト タイプ ( `kv_get` 、 `kv_prewrite` 、および`kv_commit`を含む) での gRPC リクエストの実行にかかる平均時間。                              |
| 平均 / P99 PD TSO 待機/RPC 期間 | wait-avg/99、rpc-avg/99                               | 待機: すべての TiDB インスタンスで PD が TSO を返すまでの平均時間または P99 時間。<br/> RPC: すべての TiDB インスタンスで TSO リクエストを PD に送信してから TSO を受信するまでの平均時間または P99 継続時間。 |
| 平均 / P99 ストレージ非同期書き込み期間   | 平均、99                                                | 非同期書き込みに費やされた平均時間または P99 期間。平均storage非同期書き込み期間 = 平均ストア期間 + 平均適用期間。                                                                   |
| 平均 / P99 ストア期間            | 平均、99                                                | 非同期書き込み中のループの保存に費やされる平均時間または P99 期間。                                                                                                 |
| 平均 / P99 適用期間             | 平均、99                                                | 非同期書き込み中にループを適用するために消費された平均時間または P99 期間。                                                                                             |
| 平均 / P99 追加ログ期間           | 平均、99                                                | Raftがログを追加するために費やした平均時間または P99 期間。                                                                                                   |
| 平均 / P99 コミット ログ期間        | 平均、99                                                | Raftがログをコミットするために費やした平均時間または P99 期間。                                                                                                 |
| 平均 / P99 適用ログ期間           | 平均、99                                                | Raftがログを適用するために費やした平均時間または P99 期間。                                                                                                   |

### サーバ {#server}

| メトリクス名           | ラベル                     | 説明                                 |
| :--------------- | :---------------------- | :--------------------------------- |
| TiDB 稼働時間        | インスタンス                  | 前回の再起動以降の各 TiDB インスタンスの実行時間。       |
| TiDB CPU 使用率     | インスタンス                  | 各 TiDB インスタンスの CPU 使用率の統計。         |
| TiDB のメモリ使用量     | インスタンス                  | 各 TiDB インスタンスのメモリ使用量の統計。           |
| TiKV 稼働時間        | インスタンス                  | 前回の再起動以降の各 TiKV インスタンスの実行時間。       |
| TiKV CPU 使用率     | インスタンス                  | 各 TiKV インスタンスの CPU 使用率の統計。         |
| TiKV のメモリ使用量     | インスタンス                  | 各 TiKV インスタンスのメモリ使用量の統計。           |
| TiKV IO MBps     | インスタンスの書き込み、インスタンスの読み取り | 各 TiKV インスタンスの読み取りおよび書き込みの合計バイト数。  |
| TiKV ストレージの使用量   | インスタンス                  | TiKV インスタンスごとのstorageサイズ。          |
| TiFlash稼働時間      | インスタンス                  | 前回の再起動以降の各TiFlashインスタンスのランタイム。     |
| TiFlash CPU 使用率  | インスタンス                  | 各TiFlashインスタンスの CPU 使用率の統計。        |
| TiFlashメモリ       | インスタンス                  | 各TiFlashインスタンスのメモリ使用量の統計。          |
| TiFlash IO MBps  | インスタンスの書き込み、インスタンスの読み取り | 各TiFlashインスタンスの読み取りおよび書き込みの合計バイト数。 |
| TiFlashストレージの使用量 | インスタンス                  | TiFlashインスタンスごとのstorageサイズ。        |

## FAQ {#faq}

**1. このページの一部のペインが空になっているのはなぜですか?**

ペインにメトリックが表示されない場合、考えられる理由は次のとおりです。

-   対応するクラスターのワークロードによってこのメトリクスがトリガーされることはありません。たとえば、失敗したクエリがない場合、失敗したクエリ メトリックは常に空になります。
-   クラスターのバージョンが低いです。これらのメトリクスを表示するには、TiDB の最新バージョンにアップグレードする必要があります。

これらの理由がすべて除外される場合は、トラブルシューティングのために[PingCAP サポート チーム](/tidb-cloud/tidb-cloud-support.md)に問い合わせることができます。
